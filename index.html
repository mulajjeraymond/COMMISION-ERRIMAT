<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> commision - Errimat Industries Ltd</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f4f6f8;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 480px;
      margin-right: 40px;
    }
    h2 {
      text-align: center;
      color: #004080;
    }
    label {
      font-weight: 600;
      margin-top: 10px;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      background-color: #004080;
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      border-radius: 8px;
      margin-top: 15px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background-color: #002b5c; }
    .receipt {
      margin-top: 20px;
      border: 1px dashed #004080;
      padding: 15px;
      border-radius: 8px;
      background: #fafafa;
    }
    .print-btn { background: #008000; margin-top: 10px; }
    .download-btn { background: #0077b6; margin-top: 10px; }
    .refresh-btn { background: #e63946; }
    .add-btn { background: #0066cc; }
    .print-btn:hover { background: #006400; }
    .refresh-btn:hover { background: #c71d1d; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #004080;
      color: white;
    }
    @media print {
      body * { visibility: hidden; }
      .receipt, .receipt * { visibility: visible; }
      .receipt {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Errimat Industries Ltd</h2>

  <label>Name:</label>
  <input type="text" id="name">

  <label>Department:</label>
  <select id="department">
    <option>Sales and Marketing Manager</option>
    <option>Depots</option>
    <option>Drivers</option>
    <option>Marketers</option>
    <option>Route Salers</option>
  </select>

  <label>Month:</label>
  <select id="month">
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <label>Target Amount:</label>
  <input type="number" id="target" placeholder="Enter target">

  <h3 style="margin-top:20px;">Sales Sources</h3>
  <table id="salesSourcesTable">
    <thead>
      <tr>
        <th>Source</th>
        <th>Sales (UGX)</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <th>Total Sales</th>
        <th id="totalSales">0</th>
        <th></th>
      </tr>
    </tfoot>
  </table>

  <button class="add-btn" onclick="addSourceRow()">+ Add Source</button>

  <label style="margin-top:15px;">Total Sales Amount (Auto Calculated):</label>
  <input type="number" id="sales" placeholder="Total sales" readonly>

  <button onclick="generateReceipt()">Generate Receipt</button>
  <button class="refresh-btn" onclick="refreshForm()">Clear Form</button>

  <div class="receipt" id="receipt" style="display:none;"></div>
  <button class="print-btn" id="printBtn" style="display:none;" onclick="printReceipt()">Print Receipt</button>
  <button class="download-btn" id="downloadBtn" style="display:none;" onclick="downloadPDF()">Download PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script>
function calculateCommission(department, sales, target) {
  let percent = Math.round((sales / target) * 10) * 10;


  let commissionRate = 0;

  if (percent > 100) {
    // Sales exceeded target → use 100% commission rate
    switch (department) {
      case 'Sales and Marketing Manager': commissionRate = 0.25 / 100; break;
      case 'Depots': commissionRate = 1 / 100; break;
      case 'Drivers': commissionRate = 0.5 / 100; break;
      case 'Marketers': commissionRate = 0.25 / 100; break;
      case 'Route Salers': commissionRate = 1.2 / 100; break;
    }
    return { commission: sales * commissionRate, percent, commissionRate: commissionRate * 100, note: 'Target exceeded - commission capped at 100% rate' };
  }

  // Normal condition (≤100%)
  switch (department) {
    case 'Sales and Marketing Manager':
      if (percent >= 51 && percent <= 70) commissionRate = 0.1 / 100;
      else if (percent >= 80 && percent <= 100) commissionRate = 0.25 / 100;
      break;
    case 'Depots':
      if (percent >= 50 && percent < 51) commissionRate = 0.1 / 100;
      else if (percent >= 51 && percent <= 79) commissionRate = 0.5 / 100;
      else if (percent >= 80 && percent <= 100) commissionRate = 1 / 100;
      break;
    case 'Drivers':
      if (percent < 50) commissionRate = 0.1 / 100;
      else if (percent >= 51 && percent <= 79) commissionRate = 0.25 / 100;
      else if (percent >= 80 && percent <= 100) commissionRate = 0.5 / 100;
      break;
    case 'Marketers':
      if (percent >= 51 && percent <= 79) commissionRate = 0.1 / 100;
      else if (percent >= 80 && percent <= 100) commissionRate = 0.25 / 100;
      break;
    case 'Route Salers':
      if (percent <= 50) commissionRate = 0.5 / 100;
      else if (percent >= 51 && percent <= 79) commissionRate = 0.8 / 100;
      else if (percent >= 80 && percent <= 100) commissionRate = 1.2 / 100;
      break;
  }
  return { commission: sales * commissionRate, percent, commissionRate: commissionRate * 100, note: '' };
}

function addSourceRow() {
  const tbody = document.querySelector('#salesSourcesTable tbody');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><input type="text" placeholder="e.g. Direct, Route" class="source"></td>
    <td><input type="number" class="salesInput" oninput="updateTotalSales()"></td>
    <td><button onclick="removeRow(this)">❌</button></td>
  `;
  tbody.appendChild(row);
}

function removeRow(btn) {
  btn.parentElement.parentElement.remove();
  updateTotalSales();
}

function updateTotalSales() {
  let total = 0;
  document.querySelectorAll('.salesInput').forEach(input => {
    total += parseFloat(input.value) || 0;
  });
  document.getElementById('totalSales').textContent = total.toLocaleString();
  document.getElementById('sales').value = total;
}

function generateReceipt() {
  const name = document.getElementById('name').value.trim();
  const dept = document.getElementById('department').value;
  const month = document.getElementById('month').value;
  const target = parseFloat(document.getElementById('target').value);
  const sales = parseFloat(document.getElementById('sales').value);

  if (!name || !dept || !month || !target || !sales) {
    alert("Please fill in all fields and add sales sources.");
    return;
  }

  const { commission, percent, commissionRate, note } = calculateCommission(dept, sales, target);
  const vat = commission * 0.10;
  const netCommission = commission - vat;
  const date = new Date().toLocaleDateString();

  let sourcesHTML = "";
  document.querySelectorAll('#salesSourcesTable tbody tr').forEach(row => {
    const source = row.querySelector('.source').value || "N/A";
    const amount = row.querySelector('.salesInput').value || 0;
    sourcesHTML += `<tr><td>${source}</td><td>${parseFloat(amount).toLocaleString()}</td></tr>`;
  });
    const receiptHTML = 
      <div style="display:flex; align-items:center; margin-bottom:10px;">
    <img src="https://github.com/mulajjeraymond/COMMISION-ERRIMAT/blob/main/WhatsApp%20Image%202025-10-09%20at%209.18.33%20AM(1).jpeg" alt="Errimat Industries Ltd" style="width:80px; height:auto; margin-right:15px;">
    <h2 style="font-weight:bold; margin:0;">ERRIMAT INDUSTRIES LTD</h2>
  </div>
    <p><strong>Date:</strong> ${date}</p> 
    <p><strong>Name:</strong> ${name}</p>
     <p><strong>Department:</strong> ${dept}</p>
     <p><strong>Month:</strong> ${month}</p>

    <h3>Sales Breakdown</h3>
    <table border="1" style="width:100%; border-collapse:collapse;">
      <tr><th>Source</th><th>Sales (UGX)</th></tr>
      ${sourcesHTML}
      <tr><th>Total Sales</th><th>${sales.toLocaleString()}</th></tr>
    </table>

    <p><strong>Target:</strong> UGX ${target.toLocaleString()}</p>
    <p><strong>Target Achieved:</strong> ${percent.toFixed(2)}%</p>
    <p><strong>Commission Rate Used:</strong> ${parseFloat(commissionRate.toString())}%</p>
    ${note ? `<p style="color:red;"><em>${note}</em></p>` : ""}
    <hr>
    <p><strong>Gross Commission:</strong> UGX ${commission.toLocaleString()}</p>
    <p><strong>Less 10% VAT:</strong> UGX ${vat.toLocaleString()}</p>
    <p><strong>Net Commission Payable:</strong> UGX ${netCommission.toLocaleString()}</p>
    <hr>

    <h3 style="margin-top:30px;">Signatures</h3>
    <table style="width:100%; margin-top:10px;">
      <tr><td>Prepared by: ___________________</td><td>Confirmed by: ___________________</td></tr>
      <tr><td>Verified by: ___________________</td><td>Approved by: ___________________</td></tr>
      <tr><td colspan="2">Received by: ___________________</td></tr>
    </table>
  `;

  document.getElementById('receipt').innerHTML = receiptHTML;
  document.getElementById('receipt').style.display = 'block';
  document.getElementById('printBtn').style.display = 'block';
  document.getElementById('downloadBtn').style.display = 'block';
}

function printReceipt() { window.print(); }

function downloadPDF() {
  const element = document.getElementById('receipt');
  const opt = {
    margin: 0.5,
    filename: 'Errimat_Commission_Receipt.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'A4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
}

function refreshForm() {
  document.getElementById('name').value = '';
  document.getElementById('department').selectedIndex = 0;
  document.getElementById('month').selectedIndex = 0;
  document.getElementById('target').value = '';
  document.getElementById('sales').value = '';
  document.querySelector('#salesSourcesTable tbody').innerHTML = '';
  document.getElementById('totalSales').textContent = '0';
  document.getElementById('receipt').style.display = 'none';
  document.getElementById('printBtn').style.display = 'none';
  document.getElementById('downloadBtn').style.display = 'none';
}
</script>

</body>
</html>      





